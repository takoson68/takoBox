// scripts/generate-vue-index.mjs
import fs from 'fs'
import path from 'path'
import glob from 'fast-glob'

// Generate src/components/vue-entry.js that re-exports all SFCs
// and provides a default installer plugin for app.use(...)
const baseDir = path.resolve(process.cwd(), 'src/components')
const vueFiles = await glob(path.join(baseDir, '*/', '*.vue').replace(/\\/g, '/'))

const imports = []
const exports = []
const installLines = []

for (const file of vueFiles) {
  const name = path.basename(file, '.vue')
  const rel = './' + path.relative(baseDir, file).replace(/\\/g, '/')
  imports.push(`import ${name} from '${rel}'`)
  exports.push(name)
  installLines.push(`    app.component('${name}', ${name})`)
}

const fileContent = `// generated by scripts/generate-vue-index.mjs\n${imports.join('\n')}\n\nexport {\n  ${exports.join(',\n  ')}\n}\n\nexport default {\n  install(app) {\n${installLines.join('\n')}\n  }\n}\n`

const outFile = path.join(baseDir, 'vue-entry.js')
fs.mkdirSync(path.dirname(outFile), { recursive: true })
fs.writeFileSync(outFile, fileContent)
console.log(`[generate-vue-index] vue-entry.js generated with ${vueFiles.length} entries`)

